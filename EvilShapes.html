<!DOCTYPE HTML>

<html>
  <body>
    <div id="player">

    </div>
  </body>
</html>

<style>
  #player {
    position: absolute;
    background:blue;
    width: 40px;
    height: 40px;
    left: 0 px;
    top: 0 px;
  }


</style>

<script>
  //keyUp = 38
  //keyDown = 40
  //keyLeft 37
  //keyRight = 39
  //keySpace = 32
  var posX = 0; // left
  var posY = 0; // top
  var direction = 0; // 0 up, 3 right, 6 down, 9 left

  var numberOfEnemies = 0;
  while (numberOfEnemies < 5) {
    createEnemy(30, 30, "black", 5, Math.random() * (window.innerWidth - 30),
    Math.random() * (window.innerHeight - 30));
    numberOfEnemies++;
  };
  document.onkeydown = function(event) {
    // console.log(event);
    var distance = 15;
    if (event.keyCode === 38) {
      if(posY >= 10) {
        posY -= distance;
        document.getElementById("player").style.top = posY + "px";
        direction = 0;
      }
    }
    if (event.keyCode === 40) {
      if (posY < window.innerHeight - 50) {
        posY += distance;
        document.getElementById("player").style.top = posY + "px";
        direction = 6;
      }
    }
    if (event.keyCode === 37) {
      if (posX >= 10) {
        posX -= distance;
        document.getElementById("player").style.left = posX + "px";
        direction = 9;
      }
    }
    if (event.keyCode === 39) {
      if (posX < window.innerWidth - 50) {
        posX += distance;
        document.getElementById("player").style.left = posX + "px";
        direction = 3;
      }
    }

    if (event.keyCode == 32) {
      var numberOfObjects = 0;
      shoot(direction, 5, 5, "red", 4);
    }
  }

  // function for extracting a numer from a string in style (with px).
  // Used (especially) for postioning elements
  function getNumber(str) {
    var i = 0;
    var retStr = "";
    while (!isNaN(str[i])) {
      retStr += str[i];
      i++;
    }
    return parseInt(retStr);
  }
  function isTouching(bullet) {
    var children = document.body.childNodes;
    for (var enemy in children) {
      if (children[enemy].name === 'enemy') {
        if ((getNumber(children[enemy].style.left) - getNumber(bullet.style.left)) < 0 && (getNumber(children[enemy].style.left) - getNumber(bullet.style.left)) > -40)
          if ((getNumber(bullet.style.top) - getNumber(children[enemy].style.top)) > 0 && (getNumber(bullet.style.top) - getNumber(children[enemy].style.top)) < 40) {
            return children[enemy];
          }
      }
    }
    return false;
  }

  function createEnemy(width, height, color, speed, coordX, coordY) {
    var enemy = document.createElement("DIV");
    enemy.name = "enemy";
    enemy.style.height = height + "px";
    enemy.style.width = width + "px";
    enemy.style.top = coordY + "px";
    enemy.style.left = coordX + "px";
    enemy.style.background = color;
    enemy.style.position = "absolute";
    document.body.appendChild(enemy);
    // isTouching(enemy);
  }
  // direction is on clockwise notation
  function shoot(direction, width, height, color, speed) {
    var bullet = document.createElement("DIV");
    bullet.style.height = width + "px";
    bullet.style.width = height + "px";
    bullet.style.background = color;
    bullet.style.position = "absolute";
    document.body.appendChild(bullet);

    if (direction === 0) {
      var bulletPosX = posX + 18;
      var bulletPosY = posY - 1;
      var id = setInterval(frame, 5);
      function frame() {
        if (bulletPosY < 6) {
          clearInterval(id);
          document.body.removeChild(bullet);
        }
        else {
          if (isTouching(bullet)) {
            clearInterval(id);
            document.body.removeChild(bullet);
            document.body.removeChild(isTouching(bullet));
          }
          bulletPosY -= speed;
          bullet.style.top = bulletPosY + "px";
        }
      }
    }
    if (direction === 3) {
      var bulletPosX = posX + 41;
      var bulletPosY = posY + 18;
      var id = setInterval(frame, 5);
      function frame() {
        if (bulletPosX > window.innerWidth - 6) {
            clearInterval(id);
            document.body.removeChild(bullet);
        }
        else {
          if (isTouching(bullet)) {
            clearInterval(id);
            document.body.removeChild(bullet);
            document.body.removeChild(isTouching(bullet));
          }
          bulletPosX += speed;
          bullet.style.left = bulletPosX + "px";
        }
      }
    }
    if (direction === 6) {
      var bulletPosX = posX + 18;
      var bulletPosY = posY + 41;
      var id = setInterval(frame, 5);
      function frame() {
        if (bulletPosY >= window.innerHeight - 6) {
            clearInterval(id);
            document.body.removeChild(bullet);
        }
        else {
          if (isTouching(bullet)) {
            clearInterval(id);
            document.body.removeChild(bullet);
            document.body.removeChild(isTouching(bullet));
          }
          bulletPosY += speed;
          bullet.style.top = bulletPosY + "px";
        }
      }
    }
    if (direction === 9) {
      var bulletPosX = posX - 1;
      var bulletPosY = posY + 18;
      var id = setInterval(frame, 5);
      function frame() {
        if (bulletPosX < 6) {
            clearInterval(id);
            document.body.removeChild(bullet);
        }
        else {
          if (isTouching(bullet)) {
            clearInterval(id);
            document.body.removeChild(bullet);
            document.body.removeChild(isTouching(bullet));
          }
          bulletPosX -= speed;
          bullet.style.left = bulletPosX + "px";
        }
      }
    }
    bullet.style.left = bulletPosX + "px";
    bullet.style.top = bulletPosY + "px";
  }
</script>
